<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ü©∫ Game Diagnostics</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #1a1a2e; color: white; }
        .test-section { margin: 20px 0; padding: 20px; border: 1px solid #333; border-radius: 8px; }
        .pass { background: #1e5631; border-color: #28a745; }
        .fail { background: #721c24; border-color: #dc3545; }
        .warning { background: #856404; border-color: #ffc107; }
        .test-result { margin: 10px 0; }
        button { padding: 10px 20px; margin: 10px 5px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .status { font-weight: bold; padding: 5px 10px; border-radius: 4px; }
        .pass-status { background: #28a745; }
        .fail-status { background: #dc3545; }
        .warn-status { background: #ffc107; color: black; }
        #output { background: #000; padding: 15px; border-radius: 4px; font-family: monospace; max-height: 300px; overflow-y: auto; }
    </style>
</head>
<body>
    <h1>ü©∫ Multiplayer Number Guesser - Diagnostic Report</h1>
    
    <div class="test-section">
        <h3>üîß System Status</h3>
        <div class="test-result">
            <strong>Server:</strong> <span id="serverStatus" class="status">‚è≥ Checking...</span>
        </div>
        <div class="test-result">
            <strong>Socket.IO:</strong> <span id="socketStatus" class="status">‚è≥ Checking...</span>
        </div>
        <div class="test-result">
            <strong>Game Scripts:</strong> <span id="scriptsStatus" class="status">‚è≥ Checking...</span>
        </div>
    </div>

    <div class="test-section">
        <h3>üéÆ Game Elements</h3>
        <div class="test-result">
            <strong>Ready Button:</strong> <span id="readyBtnStatus" class="status">‚è≥ Checking...</span>
        </div>
        <div class="test-result">
            <strong>Guess Button:</strong> <span id="guessBtnStatus" class="status">‚è≥ Checking...</span>
        </div>
        <div class="test-result">
            <strong>Input Fields:</strong> <span id="inputStatus" class="status">‚è≥ Checking...</span>
        </div>
        <div class="test-result">
            <strong>Event Listeners:</strong> <span id="listenersStatus" class="status">‚è≥ Checking...</span>
        </div>
    </div>

    <div class="test-section">
        <h3>üöÄ Quick Tests</h3>
        <button onclick="testButtonClicks()">Test Button Clicks</button>
        <button onclick="testValidation()">Test Input Validation</button>
        <button onclick="testSocketConnection()">Test Socket Connection</button>
        <button onclick="runFullDiagnostic()">üîç Run Full Diagnostic</button>
    </div>

    <div class="test-section">
        <h3>üìä Diagnostic Output</h3>
        <div id="output"></div>
    </div>

    <script>
        let output = document.getElementById('output');
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? '#ff6b6b' : type === 'success' ? '#51cf66' : type === 'warning' ? '#ffd43b' : '#74c0fc';
            output.innerHTML += `<div style="color: ${color}">[${timestamp}] ${message}</div>`;
            output.scrollTop = output.scrollHeight;
        }

        function setStatus(elementId, status, text) {
            const element = document.getElementById(elementId);
            element.className = `status ${status}-status`;
            element.textContent = text;
        }

        function checkServerStatus() {
            fetch('/health-check')
                .then(response => response.ok ? 'pass' : 'fail')
                .catch(() => 'fail')
                .then(status => {
                    if (status === 'pass') {
                        setStatus('serverStatus', 'pass', '‚úÖ Running');
                        log('Server is responding correctly', 'success');
                    } else {
                        setStatus('serverStatus', 'fail', '‚ùå Not responding');
                        log('Server is not responding', 'error');
                    }
                });
        }

        function checkSocketIO() {
            if (typeof io !== 'undefined') {
                setStatus('socketStatus', 'pass', '‚úÖ Loaded');
                log('Socket.IO library loaded successfully', 'success');
                
                try {
                    const testSocket = io();
                    testSocket.on('connect', () => {
                        log('Socket.IO connection successful', 'success');
                        testSocket.disconnect();
                    });
                    testSocket.on('connect_error', (error) => {
                        log('Socket.IO connection failed: ' + error, 'error');
                    });
                } catch (e) {
                    log('Socket.IO test failed: ' + e.message, 'error');
                }
            } else {
                setStatus('socketStatus', 'fail', '‚ùå Not loaded');
                log('Socket.IO library not found', 'error');
            }
        }

        function checkGameScripts() {
            const scripts = ['Game', 'UI', 'socketClient'];
            let allLoaded = true;
            
            scripts.forEach(script => {
                if (typeof window[script] === 'undefined') {
                    log(`Script missing: ${script}`, 'error');
                    allLoaded = false;
                } else {
                    log(`Script loaded: ${script}`, 'success');
                }
            });
            
            if (allLoaded) {
                setStatus('scriptsStatus', 'pass', '‚úÖ All loaded');
                log('All game scripts loaded successfully', 'success');
            } else {
                setStatus('scriptsStatus', 'fail', '‚ùå Missing scripts');
                log('Some game scripts are missing', 'error');
            }
        }

        function checkGameElements() {
            const elements = [
                { id: 'readyBtn', name: 'Ready Button' },
                { id: 'makeGuessBtn', name: 'Guess Button' },
                { id: 'secretNumber', name: 'Secret Number Input' },
                { id: 'guessInput', name: 'Guess Input' }
            ];
            
            let readyExists = !!document.getElementById('readyBtn');
            let guessExists = !!document.getElementById('makeGuessBtn');
            let secretExists = !!document.getElementById('secretNumber');
            let guessInputExists = !!document.getElementById('guessInput');
            
            setStatus('readyBtnStatus', readyExists ? 'pass' : 'fail', readyExists ? '‚úÖ Found' : '‚ùå Missing');
            setStatus('guessBtnStatus', guessExists ? 'pass' : 'fail', guessExists ? '‚úÖ Found' : '‚ùå Missing');
            setStatus('inputStatus', (secretExists && guessInputExists) ? 'pass' : 'fail', 
                     (secretExists && guessInputExists) ? '‚úÖ All found' : '‚ùå Missing inputs');
            
            elements.forEach(el => {
                const element = document.getElementById(el.id);
                if (element) {
                    log(`${el.name}: Found and accessible`, 'success');
                } else {
                    log(`${el.name}: Not found in DOM`, 'error');
                }
            });
        }

        function testButtonClicks() {
            log('Testing button click functionality...', 'info');
            
            // Test event delegation
            const readyBtn = document.getElementById('readyBtn');
            const guessBtn = document.getElementById('makeGuessBtn');
            
            if (readyBtn) {
                const event = new MouseEvent('click', { bubbles: true });
                readyBtn.dispatchEvent(event);
                log('Ready button click event dispatched', 'info');
            }
            
            if (guessBtn) {
                const event = new MouseEvent('click', { bubbles: true });
                guessBtn.dispatchEvent(event);
                log('Guess button click event dispatched', 'info');
            }
        }

        function testValidation() {
            log('Testing input validation...', 'info');
            
            if (typeof UI !== 'undefined' && UI.validateInput) {
                log('UI validation function available', 'success');
            } else {
                log('UI validation function not available', 'error');
            }
            
            if (typeof UI !== 'undefined' && UI.validateRangePair) {
                log('Range validation function available', 'success');
                
                // Test validation
                const validTest = UI.validateRangePair(1, 100);
                log(`Range validation test (1-100): ${validTest ? 'PASS' : 'FAIL'}`, validTest ? 'success' : 'error');
                
                const invalidTest = UI.validateRangePair(100, 1);
                log(`Invalid range test (100-1): ${!invalidTest ? 'PASS' : 'FAIL'}`, !invalidTest ? 'success' : 'error');
            } else {
                log('Range validation function not available', 'error');
            }
        }

        function testSocketConnection() {
            log('Testing socket connection...', 'info');
            
            if (typeof socketClient !== 'undefined') {
                log('Socket client available', 'success');
                log(`Connection status: ${socketClient.isConnected ? 'Connected' : 'Disconnected'}`, 
                    socketClient.isConnected ? 'success' : 'warning');
            } else {
                log('Socket client not available', 'error');
            }
        }

        function checkEventListeners() {
            log('Checking event listeners...', 'info');
            
            if (typeof UI !== 'undefined') {
                const readyBtn = document.getElementById('readyBtn');
                const guessBtn = document.getElementById('makeGuessBtn');
                
                let listenersOk = true;
                
                if (readyBtn && UI.handleReadyClick) {
                    log('Ready button handler function exists', 'success');
                } else {
                    log('Ready button handler missing', 'error');
                    listenersOk = false;
                }
                
                if (guessBtn && UI.handleGuessClick) {
                    log('Guess button handler function exists', 'success');
                } else {
                    log('Guess button handler missing', 'error');
                    listenersOk = false;
                }
                
                setStatus('listenersStatus', listenersOk ? 'pass' : 'fail', 
                         listenersOk ? '‚úÖ Attached' : '‚ùå Missing');
            } else {
                setStatus('listenersStatus', 'fail', '‚ùå UI not loaded');
                log('UI class not available for listener check', 'error');
            }
        }

        function runFullDiagnostic() {
            log('üîç Starting full diagnostic...', 'info');
            output.innerHTML = '';
            
            setTimeout(() => {
                checkServerStatus();
                checkSocketIO();
                checkGameScripts();
                checkGameElements();
                checkEventListeners();
                
                setTimeout(() => {
                    log('üèÅ Full diagnostic complete!', 'success');
                    log('üìã Summary: Check status indicators above', 'info');
                }, 1000);
            }, 100);
        }

        // Auto-run basic checks on load
        window.addEventListener('load', () => {
            setTimeout(() => {
                checkGameScripts();
                checkGameElements();
                checkEventListeners();
            }, 500);
        });
    </script>
    
    <!-- Load Socket.IO for testing -->
    <script src="/socket.io/socket.io.js"></script>
    
    <!-- Try to load game scripts if available -->
    <script src="/js/ui.js" onerror="console.log('UI script not loaded')"></script>
    <script src="/js/game.js" onerror="console.log('Game script not loaded')"></script>
    <script src="/js/socket-client.js" onerror="console.log('Socket client not loaded')"></script>
</body>
</html>