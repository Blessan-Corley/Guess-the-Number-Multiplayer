<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Number Guesser - Multiplayer Brain Challenge</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/styles.css">
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="/favicon.svg">
    <meta name="description" content="Real-time multiplayer number guessing game with friends">
    <meta name="theme-color" content="#1a1a2e">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Number Guesser">
</head>
<body>
    <div class="game-container">
        <!-- Header -->
        <header class="header">
            <h1>Number Guesser</h1>
            <div class="party-info" id="partyInfo" style="display:none;">
                Party: <span id="partyCodeDisplay"></span>
            </div>
        </header>

        <main class="content">
            <!-- Welcome Screen -->
            <section class="screen active" id="welcomeScreen">
                <div class="welcome-content">
                    <div class="emoji-large"><i data-lucide="gamepad-2"></i></div>
                    <h2>Welcome to the Number Guessing Challenge!</h2>
                    <p>Challenge your friends or play against our smart AI bot.</p>
                    <div class="welcome-help">
                        <a href="#" id="welcomeHowToPlay" class="help-link"><i data-lucide="info"></i> How to Play</a>
                    </div>
                </div>

                <div class="input-group">
                    <label for="playerName">Your Name</label>
                    <input type="text" class="input-field" id="playerName" placeholder="Enter your name" maxlength="20" autocomplete="name" required>
                </div>

                <div class="game-mode-selection">
                    <h3>Choose Game Mode</h3>
                    <div class="mode-buttons">
                        <button class="btn btn-mode" id="singlePlayerBtn" type="button"><i data-lucide="bot"></i> Single Player</button>
                        <button class="btn btn-mode" id="multiplayerBtn" type="button"><i data-lucide="users"></i> Multiplayer</button>
                    </div>
                </div>

                <!-- Multiplayer Options -->
                <div id="multiplayerOptions" class="multiplayer-options" style="display:none;">
                    <div class="button-group">
                        <button class="btn btn-primary" id="createPartyBtn" type="button"><i data-lucide="plus-circle"></i> Create Party</button>
                        <button class="btn btn-secondary" id="joinPartyBtn" type="button"><i data-lucide="log-in"></i> Join Party</button>
                    </div>

                    <div id="joinPartyDiv" class="join-party-section" style="display:none;">
                        <div class="input-group">
                            <label for="partyCodeInput">Party Code</label>
                            <input type="text" class="input-field" id="partyCodeInput" placeholder="Enter 6-character code" maxlength="6" style="text-transform:uppercase;" pattern="[A-Z0-9]{6}">
                        </div>
                        <button class="btn btn-primary" id="joinPartySubmitBtn" type="button"><i data-lucide="arrow-right"></i> Join Game</button>
                    </div>
                </div>

                <!-- Single Player Options -->
                <div id="singlePlayerOptions" class="single-player-options" style="display:none;">
                    <div class="settings-section">
                        <h3><i data-lucide="settings" class="inline-icon"></i> Game Settings</h3>
                        <div class="settings-grid">
                            <div class="input-group">
                                <label for="singleRangeStart">Start Number</label>
                                <input type="number" class="input-field" id="singleRangeStart" value="1" min="1" max="9999">
                            </div>
                            <div class="input-group">
                                <label for="singleRangeEnd">End Number</label>
                                <input type="number" class="input-field" id="singleRangeEnd" value="100" min="2" max="10000">
                            </div>
                        </div>
                        <div class="input-group">
                            <label for="botDifficulty">Bot Difficulty</label>
                            <select class="input-field" id="botDifficulty">
                                <option value="easy">Easy - Bot makes random guesses</option>
                                <option value="medium" selected>Medium - Bot uses basic strategy</option>
                                <option value="hard">Hard - Bot uses optimal strategy</option>
                            </select>
                        </div>
                    </div>
                    <div class="button-group">
                        <button class="btn btn-success" id="startSinglePlayerBtn" type="button"><i data-lucide="play-circle"></i> Start Single Player</button>
                        <button class="btn btn-secondary" id="howToPlaySingleBtn" type="button"><i data-lucide="help-circle"></i> How to Play</button>
                    </div>
                </div>
            </section>

            <!-- Lobby Screen -->
            <section class="screen" id="lobbyScreen">
                <div class="party-code-section">
                    <div class="party-code-label">Share this code with your friend:</div>
                    <div class="party-code-display" id="lobbyPartyCode" role="status" aria-live="polite"></div>
                    <button class="btn btn-copy" id="copyCodeBtn" type="button"><i data-lucide="copy"></i> Copy Code</button>
                </div>

                <div class="players-section">
                    <div class="players-grid">
                        <div class="player-card" id="player1Card">
                            <div class="player-avatar" role="img" aria-label="Player 1 Avatar"><i data-lucide="user"></i></div>
                            <div class="player-name" id="player1Name">
                                <span class="status-indicator offline" aria-label="Offline"></span>
                                Waiting...
                            </div>
                            <div class="player-role">Host</div>
                        </div>
                        <div class="player-card" id="player2Card">
                            <div class="player-avatar" role="img" aria-label="Player 2 Avatar"><i data-lucide="user"></i></div>
                            <div class="player-name" id="player2Name">
                                <span class="status-indicator offline" aria-label="Offline"></span>
                                Waiting for player...
                            </div>
                            <div class="player-role">Guest</div>
                        </div>
                    </div>
                </div>

                <div class="settings-section" id="gameSettings">
                    <h3><i data-lucide="target" class="inline-icon"></i> Game Settings</h3>
                    <div class="settings-grid">
                        <div class="input-group">
                            <label for="rangeStart">Start Number</label>
                            <input type="number" class="input-field" id="rangeStart" value="1" min="1" max="9999">
                            <div class="input-hint">Minimum: 1</div>
                        </div>
                        <div class="input-group">
                            <label for="rangeEnd">End Number</label>
                            <input type="number" class="input-field" id="rangeEnd" value="100" min="2" max="10000">
                            <div class="input-hint">Maximum: 10000</div>
                        </div>
                    </div>
                    <div class="range-presets">
                        <h4>Quick Presets:</h4>
                        <div class="preset-buttons">
                            <button type="button" class="btn btn-preset" onclick="Game.setRangePreset(1, 10)">1-10 (Beginner)</button>
                            <button type="button" class="btn btn-preset" onclick="Game.setRangePreset(1, 50)">1-50 (Easy)</button>
                            <button type="button" class="btn btn-preset" onclick="Game.setRangePreset(1, 100)">1-100 (Medium)</button>
                            <button type="button" class="btn btn-preset" onclick="Game.setRangePreset(1, 500)">1-500 (Hard)</button>
                            <button type="button" class="btn btn-preset" onclick="Game.setRangePreset(1, 1000)">1-1000 (Expert)</button>
                            <button type="button" class="btn btn-preset" onclick="Game.setRangePreset(1, 5000)">1-5000 (Insane)</button>
                            <button type="button" class="btn btn-preset" onclick="Game.setRangePreset(1, 10000)">1-10000 (Legendary)</button>
                        </div>
                    </div>
                    <!-- Best of 3 removed for simpler multiplayer experience -->
                    <div class="range-info">
                        <small><i data-lucide="info" class="inline-icon"></i> Current range: <span id="currentRangeDisplay">1 to 100</span> (<span id="rangeSize">100</span> numbers)</small>
                    </div>
                </div>

                <div class="button-group">
                    <button class="btn btn-success" id="startGameBtn" type="button" disabled><i data-lucide="clock"></i> Waiting for player...</button>
                    <button class="btn btn-secondary" id="howToPlayBtn" type="button"><i data-lucide="help-circle"></i> How to Play</button>
                    <button class="btn btn-danger" id="leaveLobbyBtn" type="button"><i data-lucide="log-out"></i> Leave Party</button>
                </div>
            </section>

            <!-- Selection Screen -->
            <section class="screen" id="selectionScreen">
                <div class="round-info" id="selectionRoundInfo">
                    <div class="round-text">Round 1</div>
                </div>

                <div class="timer-section">
                    <div class="timer-label">Choose your secret number:</div>
                    <div class="timer" id="selectionTimer" role="timer" aria-live="assertive">30</div>
                </div>

                <div class="message info" id="selectionMessage">
                    Choose your secret number between <span id="selectionRangeDisplay">1 and 100</span>
                </div>

                <div class="input-group">
                    <label for="secretNumber">Your Secret Number <span class="range-hint" id="secretNumberRange"></span></label>
                    <input type="number" class="input-field secret-number-input" id="secretNumber" placeholder="Enter your secret number" required>
                    <div class="input-hint" id="secretNumberHint">Choose wisely - your opponent will try to guess this!</div>
                </div>

                <div class="button-group">
                    <button class="btn btn-success" id="readyBtn" type="button"><i data-lucide="check-circle"></i> Ready</button>
                </div>

                <div class="ready-status" id="readyStatus" role="status" aria-live="polite"></div>
            </section>

            <!-- Game Screen -->
            <section class="screen" id="gameScreen">
                <div class="round-info" id="gameRoundInfo">
                    <div class="round-text">Round 1</div>
                </div>

                <div class="game-battle">
                    <div class="players-battle-grid">
                        <div class="player-battle-card" id="myBattleCard">
                            <div class="player-header">
                                <div class="player-name" id="myBattleName">You</div>
                                <div class="player-target">Guessing: <span id="opponentTarget">???</span></div>
                            </div>
                            <div class="player-stats">
                                <div class="stat">
                                    <div class="stat-number" id="myAttempts">0</div>
                                    <div class="stat-label">Attempts</div>
                                </div>
                                <div class="stat">
                                    <div class="stat-number" id="myWins">0</div>
                                    <div class="stat-label">Wins</div>
                                </div>
                            </div>
                        </div>

                        <div class="vs-divider" role="separator">VS</div>

                        <div class="player-battle-card" id="opponentBattleCard">
                            <div class="player-header">
                                <div class="player-name" id="opponentBattleName">Opponent</div>
                                <div class="player-target">Guessing: <span id="myTarget">???</span></div>
                            </div>
                            <div class="player-stats">
                                <div class="stat">
                                    <div class="stat-number" id="opponentAttempts">0</div>
                                    <div class="stat-label">Attempts</div>
                                </div>
                                <div class="stat">
                                    <div class="stat-number" id="opponentWins">0</div>
                                    <div class="stat-label">Wins</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="guess-section">
                    <div class="range-visualizer-container">
                        <div class="range-labels">
                            <span id="visualRangeMin">1</span>
                            <span>Remaining Range</span>
                            <span id="visualRangeMax">100</span>
                        </div>
                        <div class="range-visualizer">
                            <div class="range-bar-active" id="visualRangeBar" style="left: 0%; width: 100%;"></div>
                        </div>
                    </div>
                    <div class="input-group">
                        <label for="guessInput">Your Guess <span class="range-hint" id="guessRange"></span></label>
                        <input type="number" class="input-field guess-input" id="guessInput" placeholder="Enter your guess" required>
                        <div class="input-hint" id="guessHint">Find your opponent's secret number!</div>
                    </div>
                    <button class="btn btn-primary" id="makeGuessBtn" type="button"><i data-lucide="target"></i> Guess!</button>
                </div>

                <div class="message" id="gameMessage" role="status" aria-live="polite"></div>

                <div class="guess-history" id="gameGuessHistory">
                    <div class="history-header"><i data-lucide="list"></i> Your Guess History</div>
                    <div class="history-content">
                        <div class="history-placeholder">Your guess history will appear here...</div>
                    </div>
                </div>
            </section>

            <!-- Results Screen -->
            <section class="screen" id="resultsScreen">
                <div class="results-header">
                    <div class="result-emoji" id="resultEmoji" role="img" aria-label="Result"><i data-lucide="trophy"></i></div>
                    <div class="result-title" id="resultTitle">Round Complete!</div>
                </div>

                <div class="results-grid">
                    <div class="result-card" id="myResultCard">
                        <div class="result-player-name" id="myResultName">You</div>
                        <div class="result-stats">
                            <div class="result-stat">
                                <div class="result-stat-number" id="myFinalAttempts">0</div>
                                <div class="result-stat-label">Attempts</div>
                            </div>
                            <div class="result-stat">
                                <div class="result-stat-number" id="myTotalWins">0</div>
                                <div class="result-stat-label">Total Wins</div>
                            </div>
                        </div>
                        <div class="performance-badge" id="myPerformance"></div>
                    </div>

                    <div class="result-card" id="opponentResultCard">
                        <div class="result-player-name" id="opponentResultName">Opponent</div>
                        <div class="result-stats">
                            <div class="result-stat">
                                <div class="result-stat-number" id="opponentFinalAttempts">0</div>
                                <div class="result-stat-label">Attempts</div>
                            </div>
                            <div class="result-stat">
                                <div class="result-stat-number" id="opponentTotalWins">0</div>
                                <div class="result-stat-label">Total Wins</div>
                            </div>
                        </div>
                        <div class="performance-badge" id="opponentPerformance"></div>
                    </div>
                </div>

                <div class="message" id="finalResultMessage" role="status" aria-live="polite"></div>

                <div class="button-group">
                    <button class="btn btn-primary" id="nextRoundBtn" type="button" style="display:none;"><i data-lucide="play"></i> Next Round</button>
                    <button class="btn btn-success" id="rematchBtn" type="button"><i data-lucide="rotate-ccw"></i> Rematch</button>
                    <button class="btn btn-danger" id="leaveResultsBtn" type="button"><i data-lucide="home"></i> Leave Party</button>
                </div>
            </section>
        </main>
    </div>

    <!-- Connection Status -->
    <div class="connection-status" id="connectionStatus">
        <span class="loading-spinner" aria-hidden="true"></span> Connecting...
    </div>

    <!-- Notifications -->
    <div class="notification-container" id="notificationContainer" role="alert" aria-live="assertive"></div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay" style="display:none;" role="dialog" aria-modal="true" aria-labelledby="loadingText">
        <div class="loading-content">
            <div class="loading-spinner-large" aria-hidden="true"></div>
            <div class="loading-text" id="loadingText">Loading...</div>
        </div>
    </div>

    <!-- How to Play Modal -->
    <div class="modal-overlay" id="howToPlayModal" style="display:none;" role="dialog" aria-modal="true" aria-labelledby="howToPlayTitle">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="howToPlayTitle"><i data-lucide="help-circle"></i> How to Play</h2>
                <button class="modal-close" id="closeHowToPlay" aria-label="Close"><i data-lucide="x"></i></button>
            </div>
            <div class="modal-body" id="howToPlayContent">
                <!-- Content will be populated by JavaScript based on game mode -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" id="gotItBtn">Got it! <i data-lucide="check"></i></button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script src="/js/socket-client.js?v=1.2"></script>
    <script src="/js/ui.js?v=1.2"></script>
    <script src="/js/single-player.js?v=1.2"></script>
    <script src="/js/game.js?v=1.2"></script>
</body>
</html>